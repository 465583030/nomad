<div class="boxed-section-head is-light inline-definitions">
  <span>{{deployment.shortId}}</span>
  <span class="bumper-left tag {{deployment.statusClass}}">{{deployment.status}}</span>
  {{#if deployment.requiresPromotion}}
    <span class="bumper-left badge is-warning is-hollow">Requires Promotion</span>
  {{/if}}
  <span class="pull-right">
    <span class="pair is-faded">
      <span class="term">Version</span>
      <span class="has-emphasis">#{{deployment.version.number}}</span>
      <span>| {{moment-from-now deployment.version.submitTime}}</span>
    </span>
    <button class="button is-light is-compact pull-right" {{action (toggle "isOpen" this)}}>details</button>
 </span>
</div>
{{#if isOpen}}
  <div class="boxed-section-body">
    <div class="columns">
      <div class="column nowrap">
        <div class="metric-group">
          <div class="metric {{if (eq deployment.placedCanaries deployment.desiredCanaries) "is-primary"}} {{if (eq deployment.desiredCanaries 0) "is-faded"}}">
            <h3 class="label">Canaries</h3>
            <p class="value">{{deployment.placedCanaries}} / {{deployment.desiredCanaries}}</p>
          </div>
        </div>

        <div class="metric-group">
          <div class="metric">
            <h3 class="label">Placed</h3>
            <p class="value">{{deployment.placedAllocs}}</p>
          </div>
          <div class="metric">
            <h3 class="label">Desired</h3>
            <p class="value">{{deployment.desiredTotal}}</p>
          </div>
        </div>

        <div class="metric-group">
          <div class="metric {{if (gt deployment.healthyAllocs 0) "is-primary" "is-faded"}}">
            <h3 class="label">Healthy</h3>
            <p class="value">{{deployment.healthyAllocs}}</p>
          </div>
        </div>

        <div class="metric-group">
          <div class="metric {{if (gt deployment.unhealthyAllocs 0) "is-danger" "is-faded"}}">
            <h3 class="label">Unhealthy</h3>
            <p class="value">{{deployment.unhealthyAllocs}}</p>
          </div>
        </div>
      </div>
      <div class="column">
        <div class="notification {{deployment.statusClass}}">
          {{deployment.statusDescription}}
        </div>
      </div>
    </div>

    <div class="boxed-section">
      <div class="boxed-section-head">
        Task Groups
      </div>
      <div class="boxed-section-body is-full-bleed">
        {{#list-table
          source=deployment.taskGroupSummaries
          class="task-groups" as |t|}}
          {{#t.head}}
            <th>Name</th>
            <th>Needs Promotion?</th>
            <th>Auto Revert?</th>
            <th>Canaries</th>
            <th>Allocs</th>
            <th>Healthy Allocs</th>
            <th>Unhealthy Allocs</th>
          {{/t.head}}
          {{#t.body as |row|}}
            <tr>
              <td>{{row.model.name}}</td>
              <td>{{row.model.promoted}}</td>
              <td>{{row.model.autoRevert}}</td>
              <td>{{or row.model.placedCanaries 0}} / {{row.model.desiredCanaries}}</td>
              <td>{{row.model.placedAllocs}} / {{row.model.desiredTotal}}</td>
              <td>{{row.model.healthyAllocs}}</td>
              <td>{{row.model.unhealthyAllocs}}</td>
            </tr>
          {{/t.body}}
        {{/list-table}}
      </div>
    </div>

    <div class="boxed-section">
      <div class="boxed-section-head">
        Allocations
      </div>
      <div class="boxed-section-body is-full-bleed">
        {{#list-table
          source=deployment.allocations
          class="allocations" as |t|}}
          {{#t.head}}
            <th>ID</th>
            <th>Name</th>
            <th>Status</th>
            <th>Node</th>
            <th>CPU</th>
            <th>Memory</th>
          {{/t.head}}
          {{#t.body as |row|}}
            {{allocation-row allocation=row.model context="job"}}
          {{/t.body}}
        {{/list-table}}
      </div>
    </div>
  </div>
{{/if}}
